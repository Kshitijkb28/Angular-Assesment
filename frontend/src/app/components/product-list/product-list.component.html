<div class="container">
  <div class="page-header">
    <h1>üì¶ Product Management</h1>
    <p class="subtitle">Manage your product inventory with ease</p>
  </div>

  <div *ngIf="error" class="alert alert-error">
    <strong>‚ö†Ô∏è Error:</strong> {{ error }}
  </div>
  <div *ngIf="success" class="alert alert-success">
    <strong>‚úì Success:</strong> {{ success }}
  </div>

  <div class="action-bar">
    <div class="action-buttons">
      <button class="btn btn-primary" (click)="openModal()">
        <span class="btn-icon">‚ûï</span> Add Product
      </button>
      <button class="btn btn-success" (click)="openBulkUploadModal()">
        <span class="btn-icon">üì§</span> Bulk Upload
      </button>
    </div>
    <div class="report-buttons">
      <button class="btn btn-secondary" (click)="downloadReport('csv')">
        <span class="btn-icon">üìÑ</span> CSV
      </button>
      <button class="btn btn-secondary" (click)="downloadReport('xlsx')">
        <span class="btn-icon">üìä</span> XLSX
      </button>
    </div>
  </div>

  <div class="search-bar card">
    <div class="search-input-group">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        class="form-control search-input" 
        [(ngModel)]="searchTerm" 
        (keyup.enter)="onSearch()"
        placeholder="Search products by name...">
    </div>
    
    <select class="form-control category-select" [(ngModel)]="categoryFilter" (change)="onSearch()">
      <option value="">üè∑Ô∏è All Categories</option>
      <option *ngFor="let category of categories" [value]="category.id">
        {{ category.name }}
      </option>
    </select>

    <button class="btn btn-primary search-btn" (click)="onSearch()">
      <span class="btn-icon">üîç</span> Search
    </button>
  </div>

  <div *ngIf="loading" class="loading">Loading...</div>

  <div *ngIf="!loading" class="card">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Image</th>
          <th>Product Name</th>
          <th (click)="onSort('price')" class="sortable">
            üí∞ Price {{ sortBy === 'price' ? (sortOrder === 'asc' ? '‚Üë' : '‚Üì') : '‚áÖ' }}
          </th>
          <th>Category</th>
          <th>Unique ID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products; let i = index">
          <td><strong>{{ (currentPage - 1) * pageSize + i + 1 }}</strong></td>
          <td>
            <div class="product-image-wrapper">
              <img *ngIf="product.image" 
                   [src]="'http://localhost:3000/uploads/' + product.image" 
                   alt="{{ product.name }}" 
                   class="product-image">
              <div *ngIf="!product.image" class="no-image">üì∑</div>
            </div>
          </td>
          <td><strong>{{ product.name }}</strong></td>
          <td><span class="price-tag">${{ product.price }}</span></td>
          <td><span class="category-badge">{{ product.category?.name }}</span></td>
          <td><code class="unique-id">{{ product.uniqueId }}</code></td>
          <td>
            <div class="actions">
              <button class="btn btn-primary btn-sm" (click)="openModal(product)">
                ‚úèÔ∏è Edit
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteProduct(product.id)">
                üóëÔ∏è Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination" *ngIf="totalPages > 1">
      <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
        Previous
      </button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
        Next
      </button>
    </div>
  </div>
</div>

<!-- Product Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <h2>{{ editingProduct ? 'Edit Product' : 'Add Product' }}</h2>
    
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label>Product Name</label>
        <input type="text" class="form-control" formControlName="name" placeholder="Enter product name">
      </div>

      <div class="form-group">
        <label>Price</label>
        <input type="number" class="form-control" formControlName="price" placeholder="Enter price" step="0.01">
      </div>

      <div class="form-group">
        <label>Category</label>
        <select class="form-control" formControlName="categoryId">
          <option value="">Select category</option>
          <option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Image</label>
        <input type="file" class="form-control" (change)="onFileSelected($event)" accept="image/*">
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="productForm.invalid">
          {{ editingProduct ? 'Update' : 'Create' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Bulk Upload Modal -->
<div class="modal-overlay" *ngIf="showBulkUploadModal" (click)="closeBulkUploadModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <h2>Bulk Upload Products</h2>
    
    <div class="alert alert-info">
      <p><strong>Instructions:</strong></p>
      <ul>
        <li>Upload a CSV or XLSX file</li>
        <li>Required columns: name, price, categoryId</li>
        <li>Optional column: image</li>
      </ul>
    </div>

    <div class="form-group">
      <label>Select File</label>
      <input type="file" class="form-control" (change)="onBulkFileSelected($event)" 
             accept=".csv,.xlsx,.xls">
    </div>

    <div *ngIf="bulkUploadProgress" class="alert alert-info">
      {{ bulkUploadProgress }}
    </div>

    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="closeBulkUploadModal()">Cancel</button>
      <button type="button" class="btn btn-primary" (click)="onBulkUpload()" 
              [disabled]="!bulkUploadFile || bulkUploadProgress">
        Upload
      </button>
    </div>
  </div>
</div>
